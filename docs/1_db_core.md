# Техническое проектирование My_FileDB - Этап 1: Ядро базы данных
## 1.1 Архитектура хранения данных
Структура файловой системы
Система использует три специализированных файла для разделения ответственности и обеспечения эффективного доступа:

meta.db - служебный файл метаданных (22 байта)

data.db - основной файл хранения записей

index.db - файл индексов для быстрого поиска

Такой подход обеспечивает четкое разделение: метаинформация, данные и индексы хранятся изолированно, что упрощает операции резервного копирования, восстановления и целостности данных.

Формат хранения записей
Принята стратегия записей фиксированной длины размером 256 байт каждая. Это решение обеспечивает следующие преимущества:

Простота вычисления смещений - позиция любой записи вычисляется элементарно: offset = record_index * 256

Предсказуемость производительности - время доступа к любой записи постоянно

Упрощенная реализация - отсутствует необходимость в сложных алгоритмах управления памятью переменного размера

Структура записи оптимизирована для хранения информации о сотрудниках:

```text
[ID:4 байта][ФИО:100 байт][Отдел:50 байт][Должность:50 байт][Зарплата:4 байта][Дата приема:8 байт][Флаг удаления:1 байт][Выравнивание:39 байт]
```
Механизм сериализации
Преобразование объектов в байтовое представление реализовано с учетом фиксированного формата:

Целочисленные и вещественные поля хранятся в бинарном формате

Строковые поля дополняются пробелами до фиксированной длины

Даты преобразуются в числовые метки времени (timestamp)

Логические значения кодируются отдельными байтами

Заголовок базы данных
Файл meta.db содержит критически важную метаинформацию в структурированном формате:

Сигнатура формата (4 байта) - идентификатор "MFDB" для проверки корректности файла

Версия формата (2 байта) - обеспечивает совместимость при обновлениях

Количество активных записей (4 байта) - отслеживает актуальное состояние БД

Смещение первой свободной записи (8 байт) - поддерживает механизм повторного использования

Размер записи (4 байта) - обеспечивает переносимость между системами

## 1.2 Система индексов
Архитектура индексирования
Для обеспечения высокоскоростного доступа реализована хэш-таблица с открытой адресацией, хранящаяся в файле index.db. Данный подход выбран как оптимальный баланс между производительностью и сложностью реализации.

Ключевые характеристики:

Время доступа O(1) в среднем случае

Простота реализации по сравнению с древовидными структурами

Эффективное использование дискового пространства

Организация хэш-таблицы
Файл индекса имеет двухуровневую структуру:

Заголовок индекса (16 байт):

```text
[Версия:2][Емкость:4][Размер:4][Коэффициент заполнения:4][Резерв:2]
```
Массив слотов - каждый слот занимает 12 байт:

```text
[Ключ:4 байта][Смещение:8 байт]
```
Слот считается пустым если значение ключа равно -1. Начальная емкость таблицы составляет 16 слотов, что обеспечивает хорошую производительность при небольших объемах данных.

Алгоритмы работы с индексом
Хэш-функция использует метод умножения с константой золотого сечения для равномерного распределения:

java
hash = (key * 2654435761) % capacity
Разрешение коллизий осуществляется методом линейного пробирования - при возникновении коллизии выполняется поиск следующего свободного слота.

Механизм рехэширования активируется автоматически при достижении коэффициента заполнения 0.75. Система создает новую таблицу удвоенного размера и перераспределяет все существующие записи.

## 1.3 Алгоритмы основных операций
Стратегия управления пространством
Реализована гибридная стратегия логического удаления с поддержкой свободного списка:

При удалении запись помечается флагом isDeleted = true

Освободившееся место добавляется в связный список свободных блоков

При добавлении новых записей система в первую очередь использует пространство из свободного списка

Только при отсутствии свободных блоков выполняется запись в конец файла

Операция добавления записи
Процесс добавления включает следующие этапы:

Проверка уникальности - поиск существующей записи с таким же ID через индекс

Поиск свободного пространства - обращение к менеджеру свободных блоков

Сериализация данных - преобразование объекта в бинарный формат

Запись на диск - сохранение в выбранную позицию data.db

Обновление индекса - добавление соответствия ID → смещение

Обновление метаданных - увеличение счетчика записей

Операция удаления записи
Удаление реализовано как двухфазный процесс:

По ключевому полю (ID):

Быстрый поиск через индекс для получения смещения

Установка флага логического удаления

Удаление записи из хэш-таблицы индекса

Добавление блока в свободный список

Корректировка счетчика записей

По неключевому полю:

Последовательное сканирование всего файла данных

Для каждой записи проверка соответствия критерию

Выполнение процедуры удаления для каждой найденной записи

Алгоритмы поиска
Поиск по ключевому полю демонстрирует максимальную эффективность:

Обращение к хэш-таблице индекса (O(1))

Получение точного смещения искомой записи

Прямой доступ к нужной позиции в data.db

Проверка флага удаления и десериализация

Поиск по неключевому полю требует полного сканирования:

Последовательное чтение всех записей файла data.db

Для каждой записи проверка критерия поиска

Десериализация и возврат подходящих записей

Редактирование записей
Благодаря фиксированному формату записей, операция обновления реализована максимально эффективно:

Поиск существующей записи через индекс

Прямая перезапись данных в той же позиции файла

Отсутствие необходимости в перемещении данных или обновлении индекса

## 1.4 Управление памятью и производительность
Борьба с фрагментацией
Для предотвращения фрагментации дискового пространства реализованы следующие механизмы:

Свободный список - отслеживание всех освободившихся блоков

Приоритетное использование свободных блоков при добавлении новых записей

Периодическая компактизация - перезапись файла с исключением удаленных записей

Стратегия кэширования
Для оптимизации производительности применяется многоуровневое кэширование:

Буферизация операций ввода-вывода - использование 8КБ буфера для группировки операций

In-memory копия индекса - хэш-таблица загружается в оперативную память при старте

Lazy-запись - отложенная синхронизация изменений с диском

Обеспечение надежности
Несмотря на учебный характер проекта, реализованы базовые механизмы отказоустойчивости:

Атомарные операции - критичные операции выполняются через временные файлы

Контрольные точки - периодическое принудительное сохранение состояния

Валидация данных - проверка целостности при загрузке БД

Данная архитектура обеспечивает константное время выполнения операций с ключевыми полями и линейную сложность для операций с неключевыми полями, что полностью соответствует требованиям лабораторной работы к эффективности алгоритмов.